apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-rbac-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-rbac-cm
    app.kubernetes.io/part-of: argocd
data:
  # RBAC Policy Definition
  # Format: p, role, resource, action, object, effect
  policy.csv: |
    # Admin role - Full permissions
    p, role:admin, applications, *, */*, allow
    p, role:admin, clusters, *, *, allow
    p, role:admin, repositories, *, *, allow
    p, role:admin, projects, *, *, allow
    p, role:admin, accounts, *, *, allow
    p, role:admin, certificates, *, *, allow
    p, role:admin, gpgkeys, *, *, allow
    
    # Read-only role - View-only permissions
    p, role:readonly, applications, get, */*, allow
    p, role:readonly, applications, sync, */*, deny
    p, role:readonly, clusters, get, *, allow
    p, role:readonly, repositories, get, *, allow
    p, role:readonly, projects, get, *, allow
    p, role:readonly, logs, get, */*, allow
    
    # Developer role - Can sync but not delete
    p, role:developer, applications, get, */*, allow
    p, role:developer, applications, sync, */*, allow
    p, role:developer, applications, override, */*, allow
    p, role:developer, applications, delete, */*, deny
    p, role:developer, repositories, get, *, allow
    p, role:developer, projects, get, *, allow
    p, role:developer, logs, get, */*, allow
    
    # User-role assignments (format: g, user, role)
    # Default admin user
    g, admin, role:admin
    
  # Default role for authenticated users (optional)
  # Uncomment to give all authenticated users read-only access
  # policy.default: role:readonly
  
  # Anonymous users (optional)
  # policy.default: role:readonly
  
  # Scope permissions to specific projects
  # Example: p, role:team-a, applications, *, team-a/*, allow
